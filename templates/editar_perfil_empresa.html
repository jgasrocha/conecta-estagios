{% extends 'base.html' %}
{% load static %}

{% block title %}Editar Empresa - Conecta Estágio{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    body {
        background-color: #f8f9fa !important;
        margin: 0 !important;
        padding: 0 !important;
        font-family: 'Poppins', sans-serif;
    }

    .main-header, header.main-header { display: none !important; }

    .container, .container.main-container {
        max-width: 100% !important;
        width: 100% !important;
        padding: 0 !important;
        margin: 0 !important;
        background: transparent !important;
        box-shadow: none !important;
        display: block !important;
    }

    .custom-header {
      background: #007bff;
      color: white;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      box-sizing: border-box;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .custom-header nav a { color: white; margin-left: 25px; text-decoration: none; font-weight: 500; }

    .profile-container { max-width: 800px; margin: 40px auto; padding: 0 20px; }
    .profile-card { background: #fff; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow: hidden; padding-bottom: 40px; }
    
    .profile-header {
      background: linear-gradient(135deg, #007bff, #0056b3);
      padding: 40px 20px; text-align: center; color: white; margin-bottom: 30px;
    }

    .logo-edit-wrapper {
        position: relative; width: 130px; height: 130px; margin: 0 auto 15px auto;
    }
    .logo-preview {
        width: 100%; height: 100%; object-fit: cover; border-radius: 50%;
        border: 4px solid white; background: white; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .logo-edit-btn {
        position: absolute; bottom: 5px; right: 5px;
        background-color: white; color: #007bff;
        width: 40px; height: 40px; border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3); cursor: pointer;
        transition: 0.3s;
        border: 2px solid #f0f0f0;
    }
    .logo-edit-btn:hover { background-color: #f8f9fa; transform: scale(1.1); }
    .logo-edit-btn i { font-size: 18px; }

    .edit-form { padding: 0 50px; }
    
    .section-label {
        color: #007bff; font-size: 18px; font-weight: 700; 
        border-bottom: 2px solid #e7f3ff; padding-bottom: 10px; margin-bottom: 20px; margin-top: 30px;
    }

    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-weight: 600; color: #333; margin-bottom: 8px; font-size: 14px; }
    
    .input-wrapper { position: relative; }
    .input-wrapper i.edit-icon {
        position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
        color: #ccc; font-size: 14px; pointer-events: none;
    }

    input[type="text"], input[type="email"], input[type="number"], input[type="tel"], textarea, select {
        width: 100%; padding: 14px 40px 14px 15px; 
        border: 1px solid #e0e0e0; border-radius: 10px;
        font-size: 15px; background: #fcfcfc; box-sizing: border-box; transition: all 0.3s;
    }
    input:focus, textarea:focus {
        border-color: #007bff; background: #fff;
        box-shadow: 0 0 0 4px #e7f3ff; outline: none;
    }
    
    textarea { min-height: 120px; resize: vertical; }
    
    .btn-group { display: flex; gap: 15px; margin-top: 40px; justify-content: center; }
    button[type="submit"] {
        background: #007bff; color: white; padding: 14px 40px; border: none;
        border-radius: 30px; font-weight: 600; cursor: pointer; font-size: 16px;
        box-shadow: 0 4px 15px rgba(0,123,255,0.3); transition: 0.3s;
    }
    button[type="submit"]:hover { transform: translateY(-2px); background: #0056b3; }
    
    .btn-cancel {
        background: #f1f1f1; color: #555; padding: 14px 30px; border-radius: 30px;
        text-decoration: none; font-weight: 600; font-size: 16px; transition: 0.3s;
    }
    .btn-cancel:hover { background: #e2e2e2; }

    @media (max-width: 600px) {
        .edit-form { padding: 0 20px; }
        .btn-group { flex-direction: column; }
        .btn-cancel { text-align: center; }
    }
</style>
{% endblock %}

{% block content %}
<header class="custom-header">
  <div class="logo" style="font-size: 24px; font-weight: 700;">Conecta Estágio</div>
  <nav>
    <a href="{% url 'perfil_empresa' %}">Voltar</a>
  </nav>
</header>

<main class="profile-container">
  <div class="profile-card">
    
    <form method="post" enctype="multipart/form-data" class="edit-form">
        {% csrf_token %}
        
        <div class="profile-header">
            <div class="logo-edit-wrapper">
                {% if user.perfil_empresa.logo %}
                    <img src="{{ user.perfil_empresa.logo.url }}" class="logo-preview" id="logoPreview">
                {% else %}
                    <div class="logo-preview" style="display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-building" style="font-size: 50px; color: #ccc;"></i>
                    </div>
                {% endif %}
                
                <label for="id_logo" class="logo-edit-btn" title="Alterar Logo">
                    <i class="fas fa-pencil-alt"></i>
                </label>
            </div>
            
            <input type="file" name="logo" id="id_logo" accept="image/*" style="display: none;">

            <h1>Editar Empresa</h1>
            <p style="font-size: 14px; opacity: 0.8;">Toque na imagem acima para alterar sua logo</p>
        </div>

        <div class="section-label">Dados da Empresa</div>
        
        <div class="form-group">
            <label>Nome Fantasia:</label>
            <div class="input-wrapper">
                {{ profile_form.nome_empresa }}
                <i class="fas fa-pencil-alt edit-icon"></i>
            </div>
        </div>

        <div class="form-group">
            <label>CNPJ:</label>
            <div class="input-wrapper">
                {{ profile_form.cnpj }}
                <i class="fas fa-pencil-alt edit-icon"></i>
            </div>
        </div>

        <div class="form-group">
            <label>Telefone:</label>
            <div class="input-wrapper">
                {{ profile_form.telefone }}
                <i class="fas fa-pencil-alt edit-icon"></i>
            </div>
        </div>

        <div class="form-group">
            <label>Sobre a Empresa:</label>
            <div class="input-wrapper">
                {{ profile_form.descricao }}
                <i class="fas fa-pencil-alt edit-icon"></i>
            </div>
        </div>

        <div class="section-label">Dados de Acesso</div>
        <div class="form-group">
            <label>Email de Login:</label>
            <div class="input-wrapper">
                {{ user_form.email }}
                <i class="fas fa-pencil-alt edit-icon"></i>
            </div>
        </div>

        <div class="btn-group">
            <button type="submit">Salvar Alterações</button>
            <a href="{% url 'perfil_empresa' %}" class="btn-cancel">Cancelar</a>
        </div>
    </form>
  </div>
</main>

<script>
    const logoInput = document.getElementById('id_logo');
    const logoPreview = document.getElementById('logoPreview');
    const previewContainer = document.querySelector('.logo-preview');

    if(logoInput) {
        logoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (previewContainer.tagName === 'DIV') {
                        const newImg = document.createElement('img');
                        newImg.className = 'logo-preview';
                        newImg.id = 'logoPreview';
                        newImg.src = e.target.result;
                        previewContainer.parentNode.replaceChild(newImg, previewContainer);
                    } else {
                        document.getElementById('logoPreview').src = e.target.result;
                    }
                }
                reader.readAsDataURL(file);
            }
        });
    }
</script>
{% endblock %}